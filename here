const TreeNode = ({ node, onNodeClick }) => {
  const [isOpen, setIsOpen] = useState(false);

  const handleNodeClick = () => {
    setIsOpen(!isOpen);
    onNodeClick(node);
  };

  useEffect(() => {
    const shouldExpandNode = filteredData.some(filteredNode => filteredNode.id === node.id);

    if (shouldExpandNode) {
      setIsOpen(true);
    }
  }, [filteredData, node]);

  const isNodeExpanded =
    isOpen ||
    (node.children &&
      node.children.some(
        child => child.id === node.id && child.children && child.children.length > 0
      ));

  return (
    <li>
      <span onClick={handleNodeClick}>{node.name}</span>
      {isNodeExpanded && node.children.length > 0 && (
        <ul>
          {node.children.map(child => (
            <TreeNode key={child.id} node={child} onNodeClick={onNodeClick} />
          ))}
        </ul>
      )}
    </li>
  );
};
